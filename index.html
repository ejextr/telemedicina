<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MedicApp</title>
    <link rel="stylesheet" href="/static/styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://meet.jit.si/external_api.js"></script>
</head>
<body>
    <div class="app">
        <section id="login-screen" class="screen active">
            <div class="login-card">
                <div class="brand">
                    <span class="brand-mark">M</span>
                    <h1>MedicApp</h1>
                </div>
                <p class="login-subtitle">Accede con tu cuenta para continuar.</p>
                <form id="login-form">
                    <label for="login-email">Correo electronico</label>
                    <input id="login-email" name="email" type="email" placeholder="tuemail@correo.com" required>

                    <label for="login-password">Contrasena</label>
                    <input id="login-password" name="password" type="password" placeholder="********" required>

                    <div class="login-role">
                        <span>Ingresar como</span>
                        <label>
                            <input type="radio" name="login-role" value="patient" checked>
                            Paciente
                        </label>
                        <label>
                            <input type="radio" name="login-role" value="doctor">
                            Medico
                        </label>
                    </div>

                    <div class="login-extras">
                        <label class="remember">
                            <input type="checkbox" name="remember">
                            Recordarme
                        </label>
                        <a href="#" class="link forgot-link">Olvide mi contrasena</a>
                    </div>

                    <button type="submit" class="primary-button">Ingresar</button>
                    <button type="button" class="ghost-button" id="register-btn">Crear cuenta nueva</button>
                </form>
            </div>
        </section>

        <section id="register-screen" class="screen" hidden>
            <div class="signup-card">
                <button type="button" class="ghost-button ghost-sm back-button" id="back-to-login">&lt; Volver al inicio de sesion</button>
                <div class="signup-header">
                    <h1>Crear cuenta</h1>
                    <p>Elegi el tipo de perfil para personalizar tu experiencia.</p>
                </div>
                <form id="register-form">
                    <fieldset class="user-type-selector">
                        <legend>Como queres usar MedicApp?</legend>
                        <label class="selector-option">
                            <input type="radio" name="user-role" value="patient" checked>
                            <span>
                                <span class="option-title">Soy paciente</span>
                                <span class="option-copy">Reserva guardias, agenda turnos y chatea con tus medicos.</span>
                            </span>
                        </label>
                        <label class="selector-option">
                            <input type="radio" name="user-role" value="doctor">
                            <span>
                                <span class="option-title">Soy medico</span>
                                <span class="option-copy">Gestiona tu agenda, guardias y conversaciones con pacientes.</span>
                            </span>
                        </label>
                    </fieldset>

                    <div class="signup-grid">
                        <div class="field-group">
                            <label for="signup-name">Nombre completo</label>
                            <input id="signup-name" type="text" placeholder="Ej: Maria Fernanda Ortiz" required>
                        </div>
                        <div class="field-group">
                            <label for="signup-email">Correo electronico</label>
                            <input id="signup-email" type="email" placeholder="tuemail@correo.com" required>
                        </div>
                        <div class="field-group">
                            <label for="signup-password">Contrasena</label>
                            <input id="signup-password" type="password" placeholder="Minimo 8 caracteres" required>
                        </div>
                        <div class="field-group">
                            <label for="signup-confirm">Confirmar contrasena</label>
                            <input id="signup-confirm" type="password" placeholder="Repeti tu contrasena" required>
                        </div>
                    </div>

                    <div class="form-footer">
                        <label class="terms">
                            <input type="checkbox" id="signup-terms" required>
                            Acepto los terminos y la politica de privacidad.
                        </label>
                        <button type="submit" class="primary-button">Crear cuenta</button>
                    </div>
                </form>
            </div>
        </section>

        <section id="dashboard" class="screen" hidden>
            <header class="topbar" id="topbar">
                <button class="icon-button" id="menu-toggle" aria-label="Abrir menu">
                    <span class="icon-hamburger" aria-hidden="true"></span>
                </button>
                <div class="logo">MedicApp</div>
                <div class="top-actions">
                    <div class="persona-toggle" id="persona-toggle" hidden>
                        <button class="persona-btn active" data-mode="patient">Paciente</button>
                        <button class="persona-btn" data-mode="doctor">Medico</button>
                    </div>
                    <button class="icon-button" id="search-toggle" aria-label="Buscar">
                        <svg class="icon-search" viewBox="0 0 24 24" aria-hidden="true">
                            <circle cx="11" cy="11" r="7"></circle>
                            <line x1="17" y1="17" x2="22" y2="22"></line>
                        </svg>
                    </button>
                    <div class="user-pill" id="user-pill">
                        <span id="user-name">Usuario</span>
                    </div>
                </div>
            </header>

            <div class="patient-menu-overlay" id="patient-menu-overlay" hidden>
                <div class="patient-menu">
                    <button class="menu-item" data-action="guardia">Guardia</button>
                    <button class="menu-item" data-action="turnos">Turnos</button>
                    <button class="menu-item" data-action="historial">Historial</button>
                    <button class="menu-item" data-action="mensajes">Mensajes</button>
                    <button class="menu-item" data-action="perfil">Mi Perfil</button>
                    <button class="menu-item" id="logout-btn">Cerrar Sesi√≥n</button>
                </div>
            </div>

            <nav class="sidebar" id="sidebar">
                <div class="profile-summary" id="profile-summary">
                    <div>
                        <h2 id="profile-name">Nombre</h2>
                        <p id="profile-role">Rol</p>
                    </div>
                </div>
                <ul class="sidebar-menu">
                    <li class="active" data-target="patient-view"><span class="bullet"></span>Explorar medicos</li>
                    <li data-target="doctor-view" data-role-only="doctor" hidden><span class="bullet"></span>Panel profesional</li>
                    <li data-target="waiting-view"><span class="bullet"></span>Sala de espera</li>
                    <li data-target="messages-view"><span class="bullet"></span>Mensajes</li>
                    <li data-target="profile-view"><span class="bullet"></span>Configurar perfil</li>
                    <li id="logout-btn"><span class="bullet"></span>Cerrar sesion</li>
                </ul>
            </nav>

            <div class="overlay" id="overlay"></div>

            <main class="main-content">
                <section class="search-panel" id="search-panel">
                    <form class="search-form" id="search-form">
                        <div class="search-group">
                            <label for="search-name">Nombre</label>
                            <input id="search-name" type="search" placeholder="Buscar por nombre">
                        </div>
                        <div class="search-group">
                            <label for="search-guard">Guardia activa</label>
                            <select id="search-guard">
                                <option value="any">Cualquiera</option>
                                <option value="true">Disponible ahora</option>
                                <option value="false">Fuera de guardia</option>
                            </select>
                        </div>
                        <div class="search-group">
                            <label for="search-accepting">Turnos</label>
                            <select id="search-accepting">
                                <option value="any">Cualquiera</option>
                                <option value="true">Aceptando turnos</option>
                                <option value="false">Sin turnos</option>
                            </select>
                        </div>
                        <button type="submit" class="primary-button">Aplicar filtros</button>
                    </form>
                </section>

                <section id="patient-view" class="app-view">
                    <div class="patient-dashboard">
                        <div class="profile-avatar">
                            <img id="patient-avatar" src="" alt="Foto de perfil" style="display: none;">
                            <div id="avatar-placeholder">Sin foto</div>
                        </div>
                        <div class="action-buttons">
                            <div class="button-row">
                                <button class="action-btn" data-action="guardia">Guardia</button>
                                <button class="action-btn" data-action="turnos">Turnos</button>
                            </div>
                            <div class="button-row">
                                <button class="action-btn" data-action="historial">Historial</button>
                                <button class="action-btn" data-action="mensajes">Mensajes</button>
                                <button class="action-btn" data-action="perfil">Mi Perfil</button>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="doctor-view" class="app-view" hidden>
                    <div class="doctor-status-panel">
                        <h2>Disponibilidad</h2>
                        <div class="status-toggles">
                            <label class="toggle-row">
                                <span>Guardia disponible</span>
                                <button type="button" class="ghost-button" id="toggle-guard">Cargando...</button>
                            </label>
                            <label class="toggle-row">
                                <span>Turnos habilitados</span>
                                <button type="button" class="ghost-button" id="toggle-appointments">Cargando...</button>
                            </label>
                        </div>
                    </div>
                    <section class="card">
                        <header class="card-header">
                            <h3>Salas de espera</h3>
                            <button class="ghost-button ghost-sm" id="refresh-doctor-rooms">Actualizar</button>
                        </header>
                        <div id="doctor-rooms" class="waiting-list empty">
                            <p class="empty-copy">No hay pacientes esperando.</p>
                        </div>
                    </section>
                </section>

                <section class="app-view" id="profile-view" hidden>
                    <h2>Configurar Perfil</h2>
                    <form id="profile-form">
                        <div id="doctor-fields" hidden>
                            <label for="specialty">Especialidad</label>
                            <input id="specialty" name="specialty" type="text" placeholder="e.g. Cardiolog√≠a">

                            <label for="experience_years">A√±os de experiencia</label>
                            <input id="experience_years" name="experience_years" type="number" placeholder="e.g. 5">
                        </div>
                        <div id="patient-fields" hidden>
                            <label for="birth_date">Fecha de nacimiento</label>
                            <input id="birth_date" name="birth_date" type="date">

                            <label for="medical_history">Historial m√©dico</label>
                            <textarea id="medical_history" name="medical_history" placeholder="Describe tu historial m√©dico"></textarea>

                            <label for="allergies">Alergias</label>
                            <textarea id="allergies" name="allergies" placeholder="Lista tus alergias"></textarea>
                        </div>
                        <div>
                            <label for="avatar">Foto de perfil (URL)</label>
                            <input id="avatar" name="avatar" type="url" placeholder="https://ejemplo.com/avatar.jpg">
                        </div>
                        <button type="submit" class="primary-button">Guardar Cambios</button>
                    </form>
                </section>

                <section id="waiting-view" class="app-view" hidden>
                    <header class="card-header">
                        <h2>Mis salas de espera</h2>
                        <button class="ghost-button ghost-sm" id="refresh-patient-rooms">Actualizar</button>
                    </header>
                    <div id="patient-rooms" class="waiting-list empty">
                        <p class="empty-copy">Todavia no generaste una sala.</p>
                    </div>
                </section>

                <section id="messages-view" class="app-view" hidden>
                    <div class="messages-layout">
                        <aside class="thread-list" id="thread-list"></aside>
                        <div class="chat-panel" id="chat-panel" hidden>
                            <header>
                                <h3 id="chat-title">Conversacion</h3>
                                <button class="ghost-button ghost-sm" id="close-chat">Cerrar</button>
                            </header>
                            <div id="chat-messages" class="chat-messages"></div>
                            <form id="chat-form" class="chat-form">
                                <input type="text" id="chat-input" placeholder="Escribi un mensaje" required>
                                <button type="submit" class="primary-button">Enviar</button>
                            </form>
                        </div>
                    </div>
                </section>

                <section id="guardia-view" class="guardia-view" hidden>
                    <div class="chat-modal" id="mia-chat-modal">
                        <div class="chat-header">
                            <h3>Chat con Mia</h3>
                            <button class="close-chat" id="close-mia-chat">&times;</button>
                        </div>
                        <div class="chat-messages" id="mia-chat-messages">
                            <div class="message bot-message">
                                <div class="message-avatar">ü§ñ</div>
                                <div class="message-content">
                                    <p>Hola! Soy Mia, tu asistente de salud. ¬øEn qu√© puedo ayudarte hoy?</p>
                                </div>
                            </div>
                        </div>
                        <div class="chat-input">
                            <input type="text" id="mia-chat-input" placeholder="Escribe tu mensaje...">
                            <button id="send-mia-message">Enviar</button>
                        </div>
                    </div>
                    <div class="guardia-content" id="guardia-content" hidden>
                        <header class="guardia-hero">
                            <div>
                                <p class="guardia-label">Guardia en vivo</p>
                                <h2>M√©dicos Disponibles</h2>
                                <p class="guardia-subtitle">Selecciona un m√©dico para entrar a la sala de espera.</p>
                            </div>
                            <button class="ghost-button ghost-sm" id="exit-guardia">Volver al inicio</button>
                        </header>
                        <div id="doctors-on-duty" class="doctors-list">
                            <!-- Doctors will be loaded here -->
                        </div>
                    </div>
                </section>
            </main>
        </section>
    </div>

    <button id="emergency-button" class="floating-button" aria-live="polite">
        <span class="floating-icon">&#9888;</span>
        Guardia urgente
    </button>

    <div id="emergency-modal" class="emergency-modal" hidden>
        <div class="emergency-dialog">
            <h3>Necesitas ayuda urgente?</h3>
            <p>Elegi la alternativa que te resulte mas segura en este momento.</p>
            <div class="modal-actions">
                <button class="ghost-button danger-outline" id="call-emergency">Llamar a urgencias</button>
                <button class="primary-button danger-button" id="confirm-emergency">Quiero una guardia</button>
            </div>
            <button class="ghost-button ghost-wide" id="cancel-emergency">Cancelar</button>
        </div>
    </div>

    <div id="call-invite-modal" class="emergency-modal" hidden>
        <div class="emergency-dialog">
            <h3>Invitaci√≥n a videollamada</h3>
            <p>El m√©dico te est√° llamando para iniciar la consulta.</p>
            <div class="modal-actions">
                <button class="ghost-button" id="reject-call">Rechazar</button>
                <button class="primary-button" id="accept-call">Aceptar</button>
            </div>
        </div>
    </div>

    <div id="video-modal" class="video-modal" hidden>
        <div class="video-dialog">
            <div id="jitsi-container"></div>
            <button class="ghost-button" id="close-video">Cerrar llamada</button>
        </div>
    </div>

    <script src="/static/script.js"></script>
</body>
</html>
